<#@ template tier="30" #>
<Biml xmlns="http://schemas.varigence.com/biml.xsd">
    <#
        // get the source database connection
        var sourceConnection = RootNode.OleDbConnections["Source"];
        
        // specify schemas in the source database for the tables to export
        var includedSchemas = new List<string> 
        {
            "HumanResources",
            "Person",
            "Production",
            "Purchasing",
            "Sales"
        };
        
        var sourceMetadata = sourceConnection.GetDatabaseSchema(includedSchemas, null
             ,ImportOptions.ExcludeForeignKey | ImportOptions.ExcludeColumnDefault
            | ImportOptions.ExcludeViews | ImportOptions.ExcludeIndex | ImportOptions.ExcludePrimaryKey);
    #>
    <Packages>
        
        <!-- Create SSIS package that creates BCP format files -->
        <Package 
                Name="CREATE_BCP_FORMAT_FILES" 
                ConstraintMode="Parallel" 
                ProtectionLevel="DontSaveSensitive">
            <Tasks>
                <# foreach(var table in sourceMetadata.TableNodes) { #>
                        
                <# } #>
            </Tasks>
        </Package>
        
        <!-- Create SSIS package that exports tables using BCP -->
        <Package 
                Name="EXPORT_TABLES" 
                ConstraintMode="Parallel" 
                ProtectionLevel="DontSaveSensitive">
            <Tasks>
                <# foreach(var table in sourceMetadata.TableNodes) { #>
                        
                <# } #>
            </Tasks>
        </Package>
    </Packages>
</Biml>